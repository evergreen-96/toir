{% extends "base.html" %}
{% block title %}Дашборд{% endblock %}
{% block content %}
<h1 class="mb-4">Дашборд ТОиР</h1>

<div class="row g-3 mb-4">
  <div class="col-6 col-md-2"><div class="card text-bg-light"><div class="card-body"><div class="fw-semibold">Всего</div><div class="display-6">{{ stats.total }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><div class="fw-semibold">Новые</div><div class="display-6">{{ stats.new }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><div class="fw-semibold">В работе</div><div class="display-6">{{ stats.in_progress }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><div class="fw-semibold">Выполнено</div><div class="display-6">{{ stats.done }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><div class="fw-semibold">Не выполнено</div><div class="display-6">{{ stats.failed }}</div></div></div></div>
</div>

<div class="d-flex justify-content-between align-items-center mb-2">
  <h4 class="mb-0">Ближайшие плановые обслуживания</h4>
  <div>
    <a class="btn btn-sm btn-outline-secondary" href="{% url 'maintenance:plan_list' %}">Все планы</a>
    <a class="btn btn-sm btn-primary" href="{% url 'maintenance:wo_list' %}">К задачам</a>
  </div>
</div>

<table class="table table-hover align-middle">
  <thead class="table-light"><tr><th>Название</th><th>Оборудование</th><th>Локация</th><th>Следующий запуск</th><th>Интервал</th></tr></thead>
  <tbody>
  {% for p in upcoming %}
    <tr>
      <td>{{ p.name }}</td>
      <td>{{ p.workstation }}</td>
      <td>{{ p.location }}</td>
      <td>{% if p.next_run %}{{ p.next_run|date:"d.m.Y H:i" }}{% else %}—{% endif %}</td>
      <td><span class="badge text-bg-secondary badge-pill">{{ p.interval_value }} {{ p.get_interval_unit_display }}</span></td>
    </tr>
  {% empty %}
    <tr><td colspan="5"><div class="alert alert-secondary mb-0">Нет ближайших запусков</div></td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
